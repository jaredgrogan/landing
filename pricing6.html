<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universitas AI - Plans</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="icon" href="/favicon8.svg" type="image/svg+xml">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/lucide.min.css" rel="stylesheet">
    <link rel="stylesheet" href="Pricing.CSS">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script type="text/javascript" src="https://appleid.cdn-apple.com/appleauth/static/jsapi/appleid/1/en_US/appleid.auth.js"></script>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo-section">
                <a href="index.html" class="logo-container">
                    <div class="logo-circle">
                        <span class="logo-letter">U</span>
                    </div>
                </a>
                <span class="logo-text">// Discover the Universe</span>
            </div>
            <div class="date-time" id="dateTime"></div>
            <div class="day-night" id="dayNight">
                <i class="lucide-sun"></i>
            </div>
        </header>

        <main class="main-content">
            <h1>Choose Your Plan</h1>
            <div class="plans-container">
                <div class="plan">
                    <h2>Free</h2>
                    <div class="price">$0/month</div>
                    <ul>
                        <li>Basic AI assistance</li>
                        <li>Limited chat interactions</li>
                        <li>Access to public knowledge base</li>
                        <li>Basic note-taking features</li>
                    </ul>
                    <button onclick="handlePlanSelection('free')">Get Started</button>
                    <div class="signin-buttons">
                        <div id="googleSignInButton"></div>
                        <div id="appleid-signin" data-color="black" data-border="true" data-type="sign in"></div>
                    </div>
                </div>

                <div class="plan">
                    <h2>Individual</h2>
                    <div class="price">$19.99/month</div>
                    <ul>
                        <li>Advanced AI assistance</li>
                        <li>Unlimited chat interactions</li>
                        <li>Personalized learning paths</li>
                        <li>Advanced note-taking and organization</li>
                        <li>Priority support</li>
                    </ul>
                    <button onclick="handlePlanSelection('individual')">Subscribe Now</button>
                </div>

                <div class="plan">
                    <h2>Enterprise</h2>
                    <div class="price">Contact Us</div>
                    <ul>
                        <li>Custom AI solutions</li>
                        <li>Dedicated account manager</li>
                        <li>Team collaboration tools</li>
                        <li>Advanced analytics and reporting</li>
                        <li>24/7 premium support</li>
                        <li>Custom integrations</li>
                    </ul>
                    <button onclick="handlePlanSelection('enterprise')">Contact Sales</button>
                </div>
            </div>
        </main>

        <footer>
            <nav class="nav">
                <a href="index.html">Home</a>
                <a href="app.html">About</a>
                <a href="nocode.html">AI Lab</a>
                <a href="calendar.html">Mobile</a>
                <a href="learn.html">Learn</a>
                <a href="pricing.html">Plans</a>
                <a href="login.html">Login</a>
            </nav>
            <p class="copyright">&copy; 2024 Universitas AI</p>
        </footer>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/lucide.min.js"></script>
    <script>
        const dateTimeElement = document.getElementById('dateTime');
        const dayNightElement = document.getElementById('dayNight');
        const body = document.body;

        const updateDateTime = () => {
            const now = new Date();
            const timeOptions = {
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            };
            const timeStr = now.toLocaleTimeString('en-US', timeOptions);
            dateTimeElement.textContent = timeStr;
        };

        setInterval(updateDateTime, 1000);
        updateDateTime();

        dayNightElement.addEventListener('click', () => {
            body.classList.toggle('dark-mode');
            const icon = dayNightElement.querySelector('i');
            if (body.classList.contains('dark-mode')) {
                icon.classList.remove('lucide-sun');
                icon.classList.add('lucide-moon');
            } else {
                icon.classList.remove('lucide-moon');
                icon.classList.add('lucide-sun');
            }
        });

        function initGoogleSignIn() {
            google.accounts.id.initialize({
                client_id: 'YOUR_GOOGLE_CLIENT_ID', // Replace with your actual Google Client ID
                callback: handleGoogleSignIn
            });
            google.accounts.id.renderButton(
                document.getElementById("googleSignInButton"),
                { theme: "outline", size: "large" }
            );
        }

        function handleGoogleSignIn(response) {
            fetch('/auth/google', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ token: response.credential }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    localStorage.setItem('userToken', data.token);
                    window.location.href = '/dashboard';
                } else {
                    console.error('Sign-in failed:', data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        function initAppleSignIn() {
            AppleID.auth.init({
                clientId: 'YOUR_APPLE_CLIENT_ID', // Replace with your actual Apple Client ID
                scope: 'name email',
                redirectURI: 'https://your-redirect-uri.com/auth/apple-callback', // Replace with your actual redirect URI
                state: 'YOUR_STATE_STRING' // Replace with a unique state string for CSRF protection
            });
        }

        document.addEventListener('AppleIDSignInOnSuccess', (event) => {
            handleAppleSignIn(event.detail.authorization);
        });

        document.addEventListener('AppleIDSignInOnFailure', (event) => {
            console.error('Apple Sign-In failed:', event.detail.error);
        });

        function handleAppleSignIn(authorization) {
            fetch('/auth/apple', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ 
                    identityToken: authorization.id_token,
                    authorizationCode: authorization.code
                }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    localStorage.setItem('userToken', data.token);
                    window.location.href = '/dashboard';
                } else {
                    console.error('Apple Sign-In failed:', data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        function handlePlanSelection(plan) {
            if (isAuthenticated()) {
                fetch('/api/select-plan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + getUserToken()
                    },
                    body: JSON.stringify({ plan: plan })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        console.log('Plan selected:', plan);
                        window.location.href = '/dashboard';
                    } else {
                        console.error('Plan selection failed:', data.error);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            } else {
                alert('Please sign in to select a plan');
            }
        }

        function isAuthenticated() {
            return !!localStorage.getItem('userToken');
        }

        function getUserToken() {
            return localStorage.getItem('userToken');
        }

        window.onload = function() {
            initGoogleSignIn();
            initAppleSignIn();
        };
    </script>
</body>
</html>
